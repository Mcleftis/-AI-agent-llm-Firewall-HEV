name: Hybrid AI System DevSecOps

on: [push]

jobs:
  build-secure-and-test:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2

    - name: Set up Python 3.9
      uses: actions/setup-python@v2
      with:
        python-version: 3.9

    # 1. Εγκατάσταση Εξαρτήσεων ΚΑΙ Εργαλείων Ασφαλείας
    - name: Install dependencies & Security Tools
      run: |
        python -m pip install --upgrade pip
        # Εγκαθιστούμε τις βιβλιοθήκες του Project
        pip install pandas numpy gymnasium stable-baselines3 ollama pytest requests
        # Εγκαθιστούμε τα εργαλεία Cyber Security
        pip install bandit safety

    # 2. Έλεγχος Κώδικα (SAST) - Ψάχνει για Hardcoded Passwords, SQL Injection κλπ.
    - name: Security Check - SAST (Bandit)
      run: |
        # -r: αναδρομικά σε όλους τους φακέλους
        # -ll: δείξε μόνο medium και high severity προβλήματα
        bandit -r . -ll

    # 3. Έλεγχος Βιβλιοθηκών (SCA) - Ψάχνει για γνωστά CVEs (Supply Chain)
    - name: Security Check - Dependencies (Safety)
      run: |
        # Ελέγχει τα εγκατεστημένα πακέτα για γνωστές ευπάθειες
        safety check

    # 4. Λειτουργικά Τεστ (Τρέχουν ΜΟΝΟ αν περάσουν τα Security Checks)
    - name: Run Functional Tests
      run: |
        python test_all.py